{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport type { NextRequest } from 'next/server';\nimport { jwtVerify } from 'jose';\n\ninterface AuthPayload {\n  userId: string;\n  email: string;\n  perfil: 'ADMIN' | 'MODERADOR';\n}\n\nasync function verifyTokenEdge(token: string): Promise<AuthPayload | null> {\n  try {\n    const secret = new TextEncoder().encode(process.env.JWT_SECRET || '');\n    const { payload } = await jwtVerify(token, secret);\n    return payload as unknown as AuthPayload;\n  } catch {\n    return null;\n  }\n}\n\nexport async function middleware(request: NextRequest) {\n  const token = request.cookies.get('auth-token')?.value;\n  const { pathname } = request.nextUrl;\n\n  if (pathname === '/login' && token) {\n    const payload = await verifyTokenEdge(token);\n    if (payload) {\n      if (payload.perfil === 'ADMIN') {\n        return NextResponse.redirect(new URL('/admin', request.url));\n      } else {\n        return NextResponse.redirect(new URL('/moderador', request.url));\n      }\n    }\n  }\n\n  if (pathname.startsWith('/admin') || pathname.startsWith('/moderador')) {\n    if (!token) {\n      return NextResponse.redirect(new URL('/login', request.url));\n    }\n\n    const payload = await verifyTokenEdge(token);\n    if (!payload) {\n      return NextResponse.redirect(new URL('/login', request.url));\n    }\n\n    if (pathname.startsWith('/admin') && payload.perfil !== 'ADMIN') {\n      return NextResponse.redirect(new URL('/moderador', request.url));\n    }\n\n    if (pathname.startsWith('/moderador') && payload.perfil !== 'MODERADOR') {\n      return NextResponse.redirect(new URL('/admin', request.url));\n    }\n  }\n\n  return NextResponse.next();\n}\n\nexport const config = {\n  matcher: ['/admin/:path*', '/moderador/:path*', '/login'],\n};\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAEA;;;AAQA,eAAe,gBAAgB,KAAa;IAC1C,IAAI;QACF,MAAM,SAAS,IAAI,cAAc,MAAM,CAAC,QAAQ,GAAG,CAAC,UAAU,IAAI;QAClE,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,4KAAS,EAAC,OAAO;QAC3C,OAAO;IACT,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,eAAe,WAAW,OAAoB;IACnD,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,eAAe;IACjD,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IAEpC,IAAI,aAAa,YAAY,OAAO;QAClC,MAAM,UAAU,MAAM,gBAAgB;QACtC,IAAI,SAAS;YACX,IAAI,QAAQ,MAAM,KAAK,SAAS;gBAC9B,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;YAC5D,OAAO;gBACL,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,cAAc,QAAQ,GAAG;YAChE;QACF;IACF;IAEA,IAAI,SAAS,UAAU,CAAC,aAAa,SAAS,UAAU,CAAC,eAAe;QACtE,IAAI,CAAC,OAAO;YACV,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC5D;QAEA,MAAM,UAAU,MAAM,gBAAgB;QACtC,IAAI,CAAC,SAAS;YACZ,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC5D;QAEA,IAAI,SAAS,UAAU,CAAC,aAAa,QAAQ,MAAM,KAAK,SAAS;YAC/D,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,cAAc,QAAQ,GAAG;QAChE;QAEA,IAAI,SAAS,UAAU,CAAC,iBAAiB,QAAQ,MAAM,KAAK,aAAa;YACvE,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC5D;IACF;IAEA,OAAO,gMAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;QAAiB;QAAqB;KAAS;AAC3D"}}]
}